### 毕业设计项目:
#####背景介绍
我们的项目是提供楼盘资讯给用户浏览的,并提供相关业务服务.从服务架构来说.我们有图片和VR数据供用户浏览.有楼盘供用户检索.有积分会员体系激励用户成长.同时也是多个部门合作,这意味着我们有许多微服务提供者.通过学习课程结合我们的项目进行整体思考.从用户视角出发梳理整个网站架构.
#####CDN架构.
此前我们的站点图片资源背后的回源路径都是回到本机房的.这有时候就会看到机房的带宽消耗较大.而通过再架设一层.次级站点,缓解了主站点的回源压力.同时我们的APP会监控用户的行为数据.这些数据,以往也是直接发到我主站点了.压力往往较大.而考虑采用边缘计算型的方式.比如go的小型服务.收集数据.并进行集中打包发送.减轻了服务端处理这类数据的压力.
#####BFF架构.
由前端直接面对APP应用.输出的格式统一约定.而各个应用由BFF层进行对接.同时使用gRPC来约定请求和响应的服务器接口.对于接口的调用不仅速度快.还不容易出锅.而应用从BFF发出到后端服务,会调用许多的微服务.因此我们需要用链路跟踪.这里我们采用的是推特出品的zipkin.从请求的生命周期初始处加入全局的guid.每次调用都会带上这个ID.方便串联整个请求链路..这还包括了.连接mysql与redis等的耗时.与毛大在课程上说的是一致的.同时也整合了ELK的全家桶.能够方便查询到请求的日志信息.将多个服务的日志进行聚合.此处我们使用的是logstash伴生容器的方式收集日志. 
而在对接后端服务方面.以往我们是约定的接口格式,最多要求对方出好接口文档.但随着时间的推移.一些参数.就开始丢失了.变味了.而如果使用课程中提到的protobuf来定义接口.包含了接口的函数签名.入参和返回值同时支持注释,这就是一份天然的文档.而且代码更新了.他也很很好的变更.

在与后端服务交互时,我们存在重试机制.但是重试会级联放大.这个是之前没有很好处理的问题.而通过约定.收到特定错误码之后结束重试机制.比如504. 从而避免了无效的请求.

同时对代码结构目录做了梳理.以应用名+版本号做接口层的区分.

#####积分成长体系
积分成长体系,我们会针对用户的行为操作,所完成的任务进行加分操作.而加分操作往往实时性要求不高.此前我们用的是rabbitMQ来做的.通过课程学习考虑部分应用采用kafka进行重构.
由于积分最终会真实的转化为人民币.我们的后台应用是可以给用户加减积分等操作.因此这类微服务我们也是单独部署的.正如毛大所属,这属于风险等级比较高的操作.直接隔离.避免一些错误的调用导致出锅.同时后台人员的操作,,同样记录的ES里面方便搜寻.

#####关于站点缓存问题.
我们是混合使用了memcache和redis.redis使用的是redis cluster .优化了代码中多次请求缓存的操作.使用pipeline一次性操作.在处理一致性上,写操作使用SET操作命令.覆盖写缓存;读操作,使用ADD操作会写MISS数据.保障了写操作的最新数据不会被读操作的回写数据覆盖.

#####关于系统监控.
我们此前用的是Zabbix.这个是运维涉及的边界.目前尚无法涉足.这个由于前期未实行容器化服务就已经有的一套.后来公司推行了容器化.使用了K8S部署应用容器.容器化开始变得普遍.而Prometheus在这方面是有优势的.比如毛大列举的.Prometheus监控大屏Docker K8S .内存和CPU 内存详情, HTTP服务监控,RPC服务层监控,RPC依赖服务监控等. 可以较好的展现系统运行的情况.

#####关于测试问题.
以往我们是区分了环境的.预发布和线上是两套环境.毛大使用的染色发布系统.很好的区分对待了数据.又能真实测试了实际环境情况.
